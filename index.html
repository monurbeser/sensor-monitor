<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }
        body {
            background: #0f172a;
            color: #f1f5f9;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .card {
            background: #1e293b;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        canvas {
            width: 100% !important;
            height: auto !important;
        }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>ðŸ“± Telefon SensÃ¶r Paneli</h1>
    <div class="dashboard">
        <div class="card">
            <h2>Barometre (hPa)</h2>
            <canvas id="barometerGauge"></canvas>
        </div>
        <div class="card">
            <h2>Altimetre (m)</h2>
            <canvas id="altimeterGauge"></canvas>
        </div>
        <div class="card">
            <h2>Ä°vmeÃ¶lÃ§er</h2>
            <canvas id="accelerometerChart"></canvas>
        </div>
        <div class="card">
            <h2>Konum</h2>
            <p id="locationData">Bekleniyor...</p>
        </div>
    </div>

    <script>
        const seaLevelPressure = 1013.25;

        // Barometre ve Altimetre Gauge
        const createGauge = (id, label, max) => new Chart(
            document.getElementById(id), {
                type: 'doughnut',
                data: {
                    labels: [label],
                    datasets: [{
                        label: label,
                        data: [0, max],
                        backgroundColor: ['#38bdf8', '#1e293b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '80%',
                    plugins: {
                        tooltip: {enabled: false},
                        legend: {display: false},
                        title: {
                            display: true,
                            text: label,
                            color: '#fff',
                            padding: {top: 10, bottom: 10},
                        },
                    }
                }
            });

        const barometerGauge = createGauge('barometerGauge', 'BasÄ±nÃ§', 1100);
        const altimeterGauge = createGauge('altimeterGauge', 'YÃ¼kseklik', 3000);

        // Ä°vmeÃ¶lÃ§er GrafiÄŸi
        const accelChart = new Chart(document.getElementById('accelerometerChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'X', data: [], borderColor: '#f87171', fill: false },
                    { label: 'Y', data: [], borderColor: '#34d399', fill: false },
                    { label: 'Z', data: [], borderColor: '#60a5fa', fill: false },
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                }
            }
        });

        let time = 0;
        const updateAccelerometer = (x, y, z) => {
            if (accelChart.data.labels.length > 50) {
                accelChart.data.labels.shift();
                accelChart.data.datasets.forEach(ds => ds.data.shift());
            }
            accelChart.data.labels.push(time++);
            accelChart.data.datasets[0].data.push(x);
            accelChart.data.datasets[1].data.push(y);
            accelChart.data.datasets[2].data.push(z);
            accelChart.update();
        };

        // SensÃ¶r verileri okuma
        if (window.DeviceMotionEvent) {
            window.addEventListener("devicemotion", e => {
                const { x, y, z } = e.accelerationIncludingGravity;
                updateAccelerometer(x || 0, y || 0, z || 0);
            });
        }

        if ('AbsoluteOrientationSensor' in window) {
            console.log('Orientation sensor available');
        }

        // BasÄ±nÃ§ iÃ§in Barometer API (deneysel)
        if ('Barometer' in window) {
            const barometer = new Barometer({ frequency: 1 });
            barometer.addEventListener('reading', () => {
                const pressure = barometer.pressure;
                barometerGauge.data.datasets[0].data[0] = pressure;
                barometerGauge.data.datasets[0].data[1] = 1100 - pressure;
                barometerGauge.update();

                const altitude = Math.round((1 - Math.pow(pressure / seaLevelPressure, 0.190284)) * 145366.45 * 0.3048);
                altimeterGauge.data.datasets[0].data[0] = altitude;
                altimeterGauge.data.datasets[0].data[1] = 3000 - altitude;
                altimeterGauge.update();
            });
            barometer.start();
        } else {
            alert("Barometre sensÃ¶rÃ¼ desteklenmiyor.");
        }

        // Konum
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(position => {
                document.getElementById("locationData").innerText =
                    `Enlem: ${position.coords.latitude}\nBoylam: ${position.coords.longitude}\nHÄ±z: ${position.coords.speed || 0} m/s\nYÃ¼kseklik: ${position.coords.altitude || 'N/A'}`;
            }, error => {
                document.getElementById("locationData").innerText = "Konum alÄ±namadÄ±.";
            }, { enableHighAccuracy: true });
        } else {
            document.getElementById("locationData").innerText = "TarayÄ±cÄ± konum desteÄŸi vermiyor.";
        }
    </script>
</body>
</html>
