<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelişmiş Telefon Sensör Monitörü</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gauge.js/1.3.7/gauge.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .sensor-info {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 15px;
        }
        
        .sensor-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sensor-status {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .status-available {
            background-color: #2ecc71;
            color: white;
        }
        
        .status-unavailable {
            background-color: #e74c3c;
            color: white;
        }
        
        .status-waiting {
            background-color: #f39c12;
            color: white;
        }
        
        .sensor-value {
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .sensor-description {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 15px;
        }
        
        .gauge-container {
            width: 100%;
            height: 200px;
            margin: 10px auto;
            text-align: center;
        }
        
        .button-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button.csv-button {
            background-color: #27ae60;
        }
        
        button.csv-button:hover {
            background-color: #219653;
        }
        
        .permission-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .time-range-selector {
            display: flex;
            margin: 10px 0;
            border-radius: 5px;
            overflow: hidden;
            background-color: #ecf0f1;
            width: fit-content;
        }
        
        .time-range-button {
            background-color: transparent;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            color: #34495e;
            font-weight: 500;
        }
        
        .time-range-button.active {
            background-color: #3498db;
            color: white;
        }
        
        .sensor-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .update-interval {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .update-interval label {
            font-weight: 500;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 10px;
            font-size: 12px;
            color: #95a5a6;
        }
        
        .update-timer {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ecf0f1;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .time-range-button {
                padding: 6px 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Gelişmiş Telefon Sensör Monitörü</h1>
        </header>
        
        <div class="permission-warning" id="permissionWarning">
            <p><strong>Önemli:</strong> Bu uygulama telefonunuzdaki sensörlere erişmek için izin gerektirir. "Başlat" düğmesine tıklayarak izin vermeyi onaylayın.</p>
        </div>
        
        <div class="button-container">
            <button id="startButton">Başlat</button>
            <button id="stopButton" disabled>Durdur</button>
            <span id="updateTimerContainer" style="display: none;">
                Güncelleme: <span id="updateTimer" class="update-timer">10</span>
            </span>
        </div>
        
        <div class="update-interval">
            <label for="updateInterval">Güncelleme Aralığı:</label>
            <select id="updateInterval">
                <option value="1">1 saniye</option>
                <option value="5">5 saniye</option>
                <option value="10" selected>10 saniye</option>
                <option value="30">30 saniye</option>
                <option value="60">1 dakika</option>
            </select>
        </div>
        
        <!-- Hız Göstergesi (Speedometer) -->
        <div class="sensor-info">
            <div class="sensor-title">
                <div>Hız Göstergesi (GPS)</div>
                <div class="sensor-status status-waiting" id="speedStatus">Bekliyor</div>
            </div>
            <div class="sensor-description">Telefonunuzun mevcut hızını gösterir (km/saat)</div>
            <div class="gauge-container">
                <canvas id="speedGauge"></canvas>
            </div>
            <div class="sensor-value" id="speedValue">Hız: 0 km/s</div>
            <div class="sensor-actions">
                <div class="time-range-selector" id="speedTimeSelector">
                    <button class="time-range-button active" data-range="minute">1 dk</button>
                    <button class="time-range-button" data-range="hour">1 saat</button>
                    <button class="time-range-button" data-range="4hour">4 saat</button>
                    <button class="time-range-button" data-range="day">24 saat</button>
                </div>
                <button class="csv-button" data-sensor="speed">Excel'e Aktar</button>
            </div>
            <div class="chart-container">
                <canvas id="speedChart"></canvas>
            </div>
        </div>
        
        <!-- Barometrik Basınç (Barometer) -->
        <div class="sensor-info">
            <div class="sensor-title">
                <div>Barometrik Basınç (Barometre)</div>
                <div class="sensor-status status-waiting" id="pressureStatus">Bekliyor</div>
            </div>
            <div class="sensor-description">Atmosfer basıncını ölçer (hPa)</div>
            <div class="sensor-value" id="pressureValue">Basınç: 0 hPa</div>
            <div class="sensor-actions">
                <div class="time-range-selector" id="pressureTimeSelector">
                    <button class="time-range-button active" data-range="minute">1 dk</button>
                    <button class="time-range-button" data-range="hour">1 saat</button>
                    <button class="time-range-button" data-range="4hour">4 saat</button>
                    <button class="time-range-button" data-range="day">24 saat</button>
                </div>
                <button class="csv-button" data-sensor="pressure">Excel'e Aktar</button>
            </div>
            <div class="chart-container">
                <canvas id="pressureChart"></canvas>
            </div>
        </div>
        
        <!-- Accelerometer (İvmeölçer) -->
        <div class="sensor-info">
            <div class="sensor-title">
                <div>İvmeölçer (Accelerometer)</div>
                <div class="sensor-status status-waiting" id="accelerometerStatus">Bekliyor</div>
            </div>
            <div class="sensor-description">Telefonun x, y ve z eksenlerindeki hareketini ölçer</div>
            <div class="sensor-value" id="accelerometerValues">X: 0 m/s², Y: 0 m/s², Z: 0 m/s²</div>
            <div class="sensor-actions">
                <div class="time-range-selector" id="accelerometerTimeSelector">
                    <button class="time-range-button active" data-range="minute">1 dk</button>
                    <button class="time-range-button" data-range="hour">1 saat</button>
                    <button class="time-range-button" data-range="4hour">4 saat</button>
                    <button class="time-range-button" data-range="day">24 saat</button>
                </div>
                <button class="csv-button" data-sensor="accelerometer">Excel'e Aktar</button>
            </div>
            <div class="chart-container">
                <canvas id="accelerometerChart"></canvas>
            </div>
        </div>
        
        <!-- Gyroscope (Jiroskop) -->
        <div class="sensor-info">
            <div class="sensor-title">
                <div>Jiroskop (Gyroscope)</div>
                <div class="sensor-status status-waiting" id="gyroscopeStatus">Bekliyor</div>
            </div>
            <div class="sensor-description">Telefonun dönüş hızını eksenler bazında ölçer</div>
            <div class="sensor-value" id="gyroscopeValues">X: 0 rad/s, Y: 0 rad/s, Z: 0 rad/s</div>
            <div class="sensor-actions">
                <div class="time-range-selector" id="gyroscopeTimeSelector">
                    <button class="time-range-button active" data-range="minute">1 dk</button>
                    <button class="time-range-button" data-range="hour">1 saat</button>
                    <button class="time-range-button" data-range="4hour">4 saat</button>
                    <button class="time-range-button" data-range="day">24 saat</button>
                </div>
                <button class="csv-button" data-sensor="gyroscope">Excel'e Aktar</button>
            </div>
            <div class="chart-container">
                <canvas id="gyroscopeChart"></canvas>
            </div>
        </div>
        
        <!-- Orientation (Yönelim) -->
        <div class="sensor-info">
            <div class="sensor-title">
                <div>Yönelim (Orientation)</div>
                <div class="sensor-status status-waiting" id="orientationStatus">Bekliyor</div>
            </div>
            <div class="sensor-description">Telefonun alfa, beta ve gama açılarındaki konumunu gösterir</div>
            <div class="sensor-value" id="orientationValues">Alfa: 0°, Beta: 0°, Gama: 0°</div>
            <div class="sensor-actions">
                <div class="time-range-selector" id="orientationTimeSelector">
                    <button class="time-range-button active" data-range="minute">1 dk</button>
                    <button class="time-range-button" data-range="hour">1 saat</button>
                    <button class="time-range-button" data-range="4hour">4 saat</button>
                    <button class="time-range-button" data-range="day">24 saat</button>
                </div>
                <button class="csv-button" data-sensor="orientation">Excel'e Aktar</button>
            </div>
            <div class="chart-container">
                <canvas id="orientationChart"></canvas>
            </div>
        </div>
        
        <!-- Location (Konum) -->
        <div class="sensor-info">
            <div class="sensor-title">
                <div>Konum (GPS)</div>
                <div class="sensor-status status-waiting" id="locationStatus">Bekliyor</div>
            </div>
            <div class="sensor-description">Telefonun coğrafi konumunu gösterir</div>
            <div class="sensor-value" id="locationValues">Enlem: 0, Boylam: 0</div>
            <div class="sensor-actions">
                <button class="csv-button" data-sensor="location">Excel'e Aktar</button>
            </div>
        </div>
        
        <footer>
            <p>Not: Tüm sensörler tüm tarayıcılarda veya cihazlarda desteklenmeyebilir. Chrome veya Firefox'un güncel sürümleri önerilir.</p>
        </footer>
    </div>
<script>
        // DOM elementleri
        const permissionWarning = document.getElementById('permissionWarning');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const updateIntervalSelect = document.getElementById('updateInterval');
        const updateTimerContainer = document.getElementById('updateTimerContainer');
        const updateTimerElement = document.getElementById('updateTimer');
        
        // Sensör durumları
        const accelerometerStatus = document.getElementById('accelerometerStatus');
        const gyroscopeStatus = document.getElementById('gyroscopeStatus');
        const orientationStatus = document.getElementById('orientationStatus');
        const pressureStatus = document.getElementById('pressureStatus');
        const speedStatus = document.getElementById('speedStatus');
        const locationStatus = document.getElementById('locationStatus');
        
        // Sensör değerleri
        const accelerometerValues = document.getElementById('accelerometerValues');
        const gyroscopeValues = document.getElementById('gyroscopeValues');
        const orientationValues = document.getElementById('orientationValues');
        const pressureValue = document.getElementById('pressureValue');
        const speedValue = document.getElementById('speedValue');
        const locationValues = document.getElementById('locationValues');
        
        // Grafikler için gerekli değişkenler
        let accelerometerChart;
        let gyroscopeChart;
        let orientationChart;
        let pressureChart;
        let speedChart;
        let speedGauge;
        
        // Sensör nesneleri
        let accelerometer = null;
        let gyroscope = null;
        let barometer = null;
        let locationWatchId = null;
        
        // Güncelleme aralığı ve zamanlayıcı değişkenleri
        let updateInterval = 10; // varsayılan 10 saniye
        let updateTimer = updateInterval;
        let updateTimerId = null;
        
        // Veri saklama değişkenleri
        const sensorData = {
            accelerometer: {
                minute: { x: [], y: [], z: [], timestamps: [] },
                hour: { x: [], y: [], z: [], timestamps: [] },
                '4hour': { x: [], y: [], z: [], timestamps: [] },
                day: { x: [], y: [], z: [], timestamps: [] }
            },
            gyroscope: {
                minute: { x: [], y: [], z: [], timestamps: [] },
                hour: { x: [], y: [], z: [], timestamps: [] },
                '4hour': { x: [], y: [], z: [], timestamps: [] },
                day: { x: [], y: [], z: [], timestamps: [] }
            },
            orientation: {
                minute: { alpha: [], beta: [], gamma: [], timestamps: [] },
                hour: { alpha: [], beta: [], gamma: [], timestamps: [] },
                '4hour': { alpha: [], beta: [], gamma: [], timestamps: [] },
                day: { alpha: [], beta: [], gamma: [], timestamps: [] }
            },
            pressure: {
                minute: { value: [], timestamps: [] },
                hour: { value: [], timestamps: [] },
                '4hour': { value: [], timestamps: [] },
                day: { value: [], timestamps: [] }
            },
            speed: {
                minute: { value: [], timestamps: [] },
                hour: { value: [], timestamps: [] },
                '4hour': { value: [], timestamps: [] },
                day: { value: [], timestamps: [] }
            },
            location: {
                latitude: [],
                longitude: [],
                timestamps: []
            }
        };
        
        // Görüntüleme modu (dakika, saat, 4 saat, gün)
        const activeTimeRanges = {
            accelerometer: 'minute',
            gyroscope: 'minute',
            orientation: 'minute',
            pressure: 'minute',
            speed: 'minute'
        };
        
        // Gerçek zamanlı sensör değerleri
        const currentValues = {
            accelerometer: { x: 0, y: 0, z: 0 },
            gyroscope: { x: 0, y: 0, z: 0 },
            orientation: { alpha: 0, beta: 0, gamma: 0 },
            pressure: 0,
            speed: 0,
            location: { latitude: 0, longitude: 0 }
        };
        
        // Güncelleme aralığını ayarla
        updateIntervalSelect.addEventListener('change', () => {
            updateInterval = parseInt(updateIntervalSelect.value, 10);
            updateTimer = updateInterval;
            updateTimerElement.textContent = updateTimer;
        });
        
        // Zaman aralığı butonlarını ayarla
        document.querySelectorAll('.time-range-selector').forEach(selector => {
            const sensorType = selector.id.replace('TimeSelector', '');
            
            selector.querySelectorAll('.time-range-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Aktif düğmeyi güncelle
                    selector.querySelectorAll('.time-range-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    button.classList.add('active');
                    
                    // Aktif zaman aralığını güncelle
                    activeTimeRanges[sensorType] = button.dataset.range;
                    
                    // Grafiği güncelle
                    updateChart(sensorType);
                });
            });
        });
        
        // CSV dışa aktarma butonlarını ayarla
        document.querySelectorAll('.csv-button').forEach(button => {
            button.addEventListener('click', () => {
                const sensorType = button.dataset.sensor;
                exportToCSV(sensorType);
            });
        });
        
        // Hız göstergesini başlat
        function initSpeedGauge() {
            const opts = {
                angle: 0,
                lineWidth: 0.3,
                radiusScale: 1,
                pointer: {
                    length: 0.6,
                    strokeWidth: 0.035,
                    color: '#2c3e50'
                },
                limitMax: false,
                limitMin: false,
                colorStart: '#6FADCF',
                colorStop: '#8FC0DA',
                strokeColor: '#E0E0E0',
                generateGradient: true,
                highDpiSupport: true,
                staticLabels: {
                    font: "10px sans-serif",
                    labels: [0, 20, 40, 60, 80, 100, 120, 140, 160],
                    color: "#000000",
                    fractionDigits: 0
                },
                staticZones: [
                    {strokeStyle: "#30B32D", min: 0, max: 50},
                    {strokeStyle: "#FFDD00", min: 50, max: 100},
                    {strokeStyle: "#F03E3E", min: 100, max: 160}
                ],
            };
            
            const target = document.getElementById('speedGauge');
            speedGauge = new Gauge(target).setOptions(opts);
            speedGauge.maxValue = 160;
            speedGauge.setMinValue(0);
            speedGauge.animationSpeed = 32;
            speedGauge.set(0);
        }
        
        // Grafikleri başlat
        function initCharts() {
            // Accelerometer grafiği
            const accCtx = document.getElementById('accelerometerChart').getContext('2d');
            accelerometerChart = new Chart(accCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'X',
                            data: [],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Y',
                            data: [],
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Z',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
            
            // Gyroscope grafiği
            const gyroCtx = document.getElementById('gyroscopeChart').getContext('2d');
            gyroscopeChart = new Chart(gyroCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'X',
                            data: [],
                            borderColor: 'rgb(255, 159, 64)',
                            backgroundColor: 'rgba(255, 159, 64, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Y',
                            data: [],
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Z',
                            data: [],
                            borderColor: 'rgb(255, 205, 86)',
                            backgroundColor: 'rgba(255, 205, 86, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
            
            // Orientation grafiği
            const orientCtx = document.getElementById('orientationChart').getContext('2d');
            orientationChart = new Chart(orientCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Alfa',
                            data: [],
                            borderColor: 'rgb(201, 203, 207)',
                            backgroundColor: 'rgba(201, 203, 207, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Beta',
                            data: [],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Gama',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
            
            // Barometrik basınç grafiği
            const pressureCtx = document.getElementById('pressureChart').getContext('2d');
            pressureChart = new Chart(pressureCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Basınç (hPa)',
                            data: [],
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
            
            // Hız grafiği
            const speedCtx = document.getElementById('speedChart').getContext('2d');
            speedChart = new Chart(speedCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Hız (km/s)',
                            data: [],
                            borderColor: 'rgb(255, 159, 64)',
                            backgroundColor: 'rgba(255, 159, 64, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
            
            // Hız göstergesini başlat
            initSpeedGauge();
        }
        
        // Grafik güncelleme fonksiyonu
        function updateChart(sensorType) {
            const range = activeTimeRanges[sensorType];
            const data = sensorData[sensorType][range];
            
            let chart;
            switch (sensorType) {
                case 'accelerometer':
                    chart = accelerometerChart;
                    chart.data.labels = data.timestamps;
                    chart.data.datasets[0].data = data.x;
                    chart.data.datasets[1].data = data.y;
                    chart.data.datasets[2].data = data.z;
                    break;
                case 'gyroscope':
                    chart = gyroscopeChart;
                    chart.data.labels = data.timestamps;
                    chart.data.datasets[0].data = data.x;
                    chart.data.datasets[1].data = data.y;
                    chart.data.datasets[2].data = data.z;
                    break;
                case 'orientation':
                    chart = orientationChart;
                    chart.data.labels = data.timestamps;
                    chart.data.datasets[0].data = data.alpha;
                    chart.data.datasets[1].data = data.beta;
                    chart.data.datasets[2].data = data.gamma;
                    break;
                case 'pressure':
                    chart = pressureChart;
                    chart.data.labels = data.timestamps;
                    chart.data.datasets[
case 'pressure':
                    chart = pressureChart;
                    chart.data.labels = data.timestamps;
                    chart.data.datasets[0].data = data.value;
                    break;
                case 'speed':
                    chart = speedChart;
                    chart.data.labels = data.timestamps;
                    chart.data.datasets[0].data = data.value;
                    break;
            }
            
            chart.update();
        }
        
        // Tüm grafikleri güncelle
        function updateAllCharts() {
            updateChart('accelerometer');
            updateChart('gyroscope');
            updateChart('orientation');
            updateChart('pressure');
            updateChart('speed');
        }
        
        // Veri ekleme fonksiyonu - belirli bir zaman aralığı için
        function addDataToTimeRange(sensorType, range, newData) {
            const data = sensorData[sensorType][range];
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                               now.getMinutes().toString().padStart(2, '0') + ':' + 
                               now.getSeconds().toString().padStart(2, '0');
            
            data.timestamps.push(timeString);
            
            // Her sensör türüne göre farklı veri ekleme
            switch (sensorType) {
                case 'accelerometer':
                    data.x.push(newData.x);
                    data.y.push(newData.y);
                    data.z.push(newData.z);
                    
                    // Dakikalık veriler için 60 veri noktası limitini aşma
                    if (range === 'minute' && data.timestamps.length > 60) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    
                    // Saatlik veriler için 360 veri noktası limitini aşma
                    if (range === 'hour' && data.timestamps.length > 360) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    
                    // 4 saatlik veriler için 1440 veri noktası limitini aşma
                    if (range === '4hour' && data.timestamps.length > 1440) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    
                    // Günlük veriler için 8640 veri noktası limitini aşma
                    if (range === 'day' && data.timestamps.length > 8640) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    break;
                    
                case 'gyroscope':
                    data.x.push(newData.x);
                    data.y.push(newData.y);
                    data.z.push(newData.z);
                    
                    // Veri limiti kontrolü
                    if (range === 'minute' && data.timestamps.length > 60) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    
                    if (range === 'hour' && data.timestamps.length > 360) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    
                    if (range === '4hour' && data.timestamps.length > 1440) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    
                    if (range === 'day' && data.timestamps.length > 8640) {
                        data.timestamps.shift();
                        data.x.shift();
                        data.y.shift();
                        data.z.shift();
                    }
                    break;
                    
                case 'orientation':
                    data.alpha.push(newData.alpha);
                    data.beta.push(newData.beta);
                    data.gamma.push(newData.gamma);
                    
                    // Veri limiti kontrolü
                    if (range === 'minute' && data.timestamps.length > 60) {
                        data.timestamps.shift();
                        data.alpha.shift();
                        data.beta.shift();
                        data.gamma.shift();
                    }
                    
                    if (range === 'hour' && data.timestamps.length > 360) {
                        data.timestamps.shift();
                        data.alpha.shift();
                        data.beta.shift();
                        data.gamma.shift();
                    }
                    
                    if (range === '4hour' && data.timestamps.length > 1440) {
                        data.timestamps.shift();
                        data.alpha.shift();
                        data.beta.shift();
                        data.gamma.shift();
                    }
                    
                    if (range === 'day' && data.timestamps.length > 8640) {
                        data.timestamps.shift();
                        data.alpha.shift();
                        data.beta.shift();
                        data.gamma.shift();
                    }
                    break;
                    
                case 'pressure':
                case 'speed':
                    data.value.push(newData);
                    
                    // Veri limiti kontrolü
                    if (range === 'minute' && data.timestamps.length > 60) {
                        data.timestamps.shift();
                        data.value.shift();
                    }
                    
                    if (range === 'hour' && data.timestamps.length > 360) {
                        data.timestamps.shift();
                        data.value.shift();
                    }
                    
                    if (range === '4hour' && data.timestamps.length > 1440) {
                        data.timestamps.shift();
                        data.value.shift();
                    }
                    
                    if (range === 'day' && data.timestamps.length > 8640) {
                        data.timestamps.shift();
                        data.value.shift();
                    }
                    break;
            }
        }
        
        // Tüm zaman aralıklarına veri ekle
        function addDataToAllTimeRanges(sensorType, newData) {
            addDataToTimeRange(sensorType, 'minute', newData);
            addDataToTimeRange(sensorType, 'hour', newData);
            addDataToTimeRange(sensorType, '4hour', newData);
            addDataToTimeRange(sensorType, 'day', newData);
        }
        
        // Gerçek zamanlı sensör verilerini işle
        function processRealtimeSensorData() {
            // Accelerometer verilerini işle
            addDataToAllTimeRanges('accelerometer', currentValues.accelerometer);
            
            // Gyroscope verilerini işle
            addDataToAllTimeRanges('gyroscope', currentValues.gyroscope);
            
            // Orientation verilerini işle
            addDataToAllTimeRanges('orientation', currentValues.orientation);
            
            // Barometrik basınç verilerini işle
            addDataToAllTimeRanges('pressure', currentValues.pressure);
            
            // Hız verilerini işle
            addDataToAllTimeRanges('speed', currentValues.speed);
            
            // Konum verilerini işle
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                              now.getMinutes().toString().padStart(2, '0') + ':' + 
                              now.getSeconds().toString().padStart(2, '0');
                              
            sensorData.location.timestamps.push(timeString);
            sensorData.location.latitude.push(currentValues.location.latitude);
            sensorData.location.longitude.push(currentValues.location.longitude);
            
            // Konum verisi limiti
            if (sensorData.location.timestamps.length > 1000) {
                sensorData.location.timestamps.shift();
                sensorData.location.latitude.shift();
                sensorData.location.longitude.shift();
            }
            
            // Grafikleri güncelle
            updateAllCharts();
            
            // Hız göstergesini güncelle
            speedGauge.set(currentValues.speed);
        }
        
        // Sensör değerlerini güncelle
        function updateSensorValues() {
            // Accelerometer değerlerini güncelle
            accelerometerValues.textContent = `X: ${currentValues.accelerometer.x.toFixed(2)} m/s², Y: ${currentValues.accelerometer.y.toFixed(2)} m/s², Z: ${currentValues.accelerometer.z.toFixed(2)} m/s²`;
            
            // Gyroscope değerlerini güncelle
            gyroscopeValues.textContent = `X: ${currentValues.gyroscope.x.toFixed(2)} rad/s, Y: ${currentValues.gyroscope.y.toFixed(2)} rad/s, Z: ${currentValues.gyroscope.z.toFixed(2)} rad/s`;
            
            // Orientation değerlerini güncelle
            orientationValues.textContent = `Alfa: ${currentValues.orientation.alpha.toFixed(2)}°, Beta: ${currentValues.orientation.beta.toFixed(2)}°, Gama: ${currentValues.orientation.gamma.toFixed(2)}°`;
            
            // Barometrik basınç değerini güncelle
            pressureValue.textContent = `Basınç: ${currentValues.pressure.toFixed(2)} hPa`;
            
            // Hız değerini güncelle
            speedValue.textContent = `Hız: ${currentValues.speed.toFixed(2)} km/s`;
            
            // Konum değerlerini güncelle
            locationValues.textContent = `Enlem: ${currentValues.location.latitude.toFixed(6)}, Boylam: ${currentValues.location.longitude.toFixed(6)}`;
        }
        
        // Veri toplama işlemini başlat
        function startDataCollection() {
            processRealtimeSensorData();
            updateSensorValues();
            startUpdateTimer();
        }
        
        // Veri toplama işlemini durdur
        function stopDataCollection() {
            stopUpdateTimer();
        }
        
        // Güncelleme sayacını başlat
        function startUpdateTimer() {
            updateTimerContainer.style.display = 'inline-block';
            updateTimer = updateInterval;
            updateTimerElement.textContent = updateTimer;
            
            updateTimerId = setInterval(() => {
                updateTimer--;
                updateTimerElement.textContent = updateTimer;
                
                if (updateTimer <= 0) {
                    updateTimer = updateInterval;
                    updateTimerElement.textContent = updateTimer;
                    
                    // Sensör değerlerini ve grafikleri güncelle
                    processRealtimeSensorData();
                    updateSensorValues();
                }
            }, 1000);
        }
        
        // Güncelleme sayacını durdur
        function stopUpdateTimer() {
            clearInterval(updateTimerId);
            updateTimerContainer.style.display = 'none';
        }
        
        // CSV dışa aktarma fonksiyonu
        function exportToCSV(sensorType) {
            let csvContent = 'data:text/csv;charset=utf-8,';
            let header = '';
            let rows = [];
            
            switch (sensorType) {
                case 'accelerometer':
                    header = 'Zaman,X (m/s²),Y (m/s²),Z (m/s²)';
                    
                    const accData = sensorData.accelerometer[activeTimeRanges.accelerometer];
                    for (let i = 0; i < accData.timestamps.length; i++) {
                        rows.push(`${accData.timestamps[i]},${accData.x[i]},${accData.y[i]},${accData.z[i]}`);
                    }
                    break;
                    
                case 'gyroscope':
                    header = 'Zaman,X (rad/s),Y (rad/s),Z (rad/s)';
                    
                    const gyroData = sensorData.gyroscope[activeTimeRanges.gyroscope];
                    for (let i = 0; i < gyroData.timestamps.length; i++) {
                        rows.push(`${gyroData.timestamps[i]},${gyroData.x[i]},${gyroData.y[i]},${gyroData.z[i]}`);
                    }
                    break;
                    
                case 'orientation':
                    header = 'Zaman,Alfa (°),Beta (°),Gama (°)';
                    
                    const orientData = sensorData.orientation[activeTimeRanges.orientation];
                    for (let i = 0; i < orientData.timestamps.length; i++) {
                        rows.push(`${orientData.timestamps[i]},${orientData.alpha[i]},${orientData.beta[i]},${orientData.gamma[i]}`);
                    }
                    break;
                    
                case 'pressure':
                    header = 'Zaman,Basınç (hPa)';
                    
                    const pressureData = sensorData.pressure[activeTimeRanges.pressure];
                    for (let i = 0; i < pressureData.timestamps.length; i++) {
                        rows.push(`${pressureData.timestamps[i]},${pressureData.value[i]}`);
                    }
                    break;
                    
                case 'speed':
                    header = 'Zaman,Hız (km/s)';
                    
                    const speedData = sensorData.speed[activeTimeRanges.speed];
                    for (let i = 0; i < speedData.timestamps.length; i++) {
                        rows.push(`${speedData.timestamps[i]},${speedData.value[i]}`);
                    }
                    break;
                    
                case 'location':
                    header = 'Zaman,Enlem,Boylam';
                    
                    for (let i = 0; i < sensorData.location.timestamps.length; i++) {
                        rows.push(`${sensorData.location.timestamps[i]},${sensorData.location.latitude[i]},${sensorData.location.longitude[i]}`);
                    }
                    break;
            }
            
            csvContent += header + '\n' + rows.join('\n');
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `${sensorType}_verileri.csv`);
            document.body.appendChild(link);
            
            link.click();
            document.body.removeChild(link);
        }
        
        // Sensörleri başlat
        function startSensors() {
            // Başlatma düğmesini devre dışı bırak
            startButton.disabled = true;
            stopButton.disabled = false;
            permissionWarning.style.display = 'none';
            
            // Accelerometer
            try {
                if ('Accelerometer' in window) {
                    accelerometer = new Accelerometer({ frequency: 60 });
                    accelerometer.addEventListener('reading', () => {
                        currentValues.accelerometer = {
                            x: accelerometer.x,
                            y: accelerometer.y,
                            z: accelerometer.z
                        };
                    });
                    accelerometer.start();
                    accelerometerStatus.textContent = 'Aktif';
                    accelerometerStatus.className = 'sensor-status status-available';
                } else {
                    accelerometerStatus.textContent = 'Desteklenmiyor';
                    accelerometerStatus.className = 'sensor-status status-unavailable';
                }
            } catch (error) {
                accelerometerStatus.textContent = 'Hata: ' + error.message;
                accelerometerStatus.className = 'sensor-status status-unavailable';
            }
            
            // Gyroscope
            try {
                if ('Gyroscope' in window) {
                    gyroscope = new Gyroscope({ frequency: 60 });
                    gyroscope.addEventListener('reading', () => {
                        currentValues.gyroscope = {
                            x: gyroscope.x,
                            y: gyroscope.y,
                            z: gyroscope.z
                        };
                    });
                    gyroscope.start();
                    gyroscopeStatus.textContent = 'Aktif';
                    gyroscopeStatus.className = 'sensor-status status-available';
                } else {
                    gyroscopeStatus.textContent = 'Desteklenmiyor';
                    gyroscopeStatus.className = 'sensor-status status-unavailable';
                }
            } catch (error) {
                gyroscopeStatus.textContent = 'Hata: ' + error.message;
                gyroscopeStatus.className = 'sensor-status status-unavailable';
            }
            
            // Barometrik basınç sensörü
            try {
                if ('Pressure' in window) {
                    barometer = new Pressure({ frequency: 60 });
                    barometer.addEventListener('reading', () => {
                        currentValues.pressure = barometer.pressure;
                    });
                    barometer.start();
                    pressureStatus.textContent = 'Aktif';
                    pressureStatus.className = 'sensor-status status-available';
                } else {
                    pressureStatus.textContent = 'Desteklenmiyor';
                    pressureStatus.className = 'sensor-status status-unavailable';
                    
                    // Desteklenmiyorsa simüle et
                    currentValues.pressure = 1013.25; // Deniz seviyesinde ortalama basınç
                    
                    // Rasgele değişimler ekle
                    setInterval(() => {
                        currentValues.pressure += (Math.random() - 0.5) * 0.2;
                    }, 1000);
                }
            } catch (error) {
                pressureStatus.textContent = 'Hata: ' + error.message;
                pressureStatus.className = 'sensor-status status-unavailable';
                
                // Hata durumunda simüle et
                currentValues.pressure = 1013.25;
                
                // Rasgele değişimler ekle
                setInterval(() => {
                    currentValues.pressure += (Math.random() - 0.5) * 0.2;
                }, 1000);
            }
            
            // Device Orientation
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', (event) => {
                    currentValues.orientation = {
                        alpha: event.alpha || 0,
                        beta: event.beta || 0,
                        gamma: event.gamma || 0
                    };
                });
                orientationStatus.textContent = 'Aktif';
                orientationStatus.className = 'sensor-status status-available';
            } else {
                orientationStatus.textContent = 'Desteklenmiyor';
                orientationStatus.className = 'sensor-status status-unavailable';
            }
            
            // Geolocation ve Hız
            if (navigator.geolocation) {
                let lastPosition = null;
                
                locationWatchId = navigator.geolocation.watchPosition(
                    (position) => {
                        currentValues.location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        
                        // Hız bilgisi
                        if (position.coords.speed !== null) {
                            // GPS'den gelen hızı km/s'ye çevir (m/s -> km/s)
                            currentValues.speed = position.coords.speed * 3.6;
                        } else if (lastPosition) {
                            // Hız bilgisi yoksa iki konum arasındaki mesafeden hesapla
                            const distance = calculateDistance(
                                lastPosition.coords.latitude,
                                lastPosition.coords.longitude,
                                position.coords.latitude,
                                position.coords.longitude
                            );
                            
                            const timeDiff = (position.timestamp - lastPosition.timestamp) / 1000; // saniye cinsinden
                            const calculatedSpeed = (distance / timeDiff) * 3.6; // km/s olarak
                            
                            currentValues.speed = calculatedSpeed;
                        } else {
                            currentValues.speed = 0;
                        }
                        
                        lastPosition = position;
                        
                        locationStatus.textContent = 'Aktif';
                        locationStatus.className = 'sensor-status status-available';
                        speedStatus.textContent = 'Aktif';
                        speedStatus.className = 'sensor-status status-available';
                    },
                    (error) => {
                        locationStatus.textContent = 'Hata: ' + error.message;
                        locationStatus.className = 'sensor-status status-unavailable';
                        speedStatus.textContent = 'Hata: GPS kullanılamıyor';
                        speedStatus.className = 'sensor-status status-unavailable';
                        
                        // Hata durumunda simüle et
                        setInterval(() => {
                            currentValues.speed = Math.random() * 60; // 0-60 km/s arasında rasgele değer
                        }, 2000);
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 0,
                        timeout: 5000
                    }
                );
            } else {
                locationStatus.textContent = 'Desteklenmiyor';
                locationStatus.className = 'sensor-status status-unavailable';
                speedStatus.textContent = 'Desteklenmiyor';
                speedStatus.className = 'sensor-status status-unavailable';
                
                // Desteklenmiyorsa hızı simüle et
                setInterval(() => {
                    currentValues.speed = Math.random() * 60; // 0-60 km/s arasında rasgele değer
                }, 2000);
            }
            
            // Veri toplama işlemini başlat
            startDataCollection();
        }
        
        // Sensörleri durdur
        function stopSensors() {
            // Durdurma düğmesini devre dışı bırak
            startButton.disabled = false;
            stopButton.disabled = true;
            
            // Accelerometer
            if (accelerometer) {
                accelerometer.stop();
                accelerometerStatus.textContent = 'Durduruldu';
                accelerometerStatus.className = 'sensor-status status-waiting';
            }
            
            // Gyroscope
            if (gyroscope) {
                gyroscope.stop();
                gyroscopeStatus.textContent = 'Durduruldu';
                gyroscopeStatus.className = 'sensor-status status-waiting';
            }
            
            // Barometrik basınç sensörü
            if (barometer) {
                barometer.stop();
                pressureStatus.textContent = 'Durduruldu';
                pressureStatus.className = 'sensor-status status-waiting';
            }
            
            // Geolocation
            if (locationWatchId !== null) {
                navigator.geolocation.clearWatch(locationWatchId);
                locationWatchId = null;
                locationStatus.textContent = 'Durduruldu';
                locationStatus.className = 'sensor-status status-waiting';
                speedStatus.textContent = 'Durduruldu';
                speedStatus.className = 'sensor-status status-waiting';
            }
            
            // Orientation olayını durdur
            window.removeEventListener('deviceorientation', () => {});
            orientationStatus.textContent = 'Durduruldu';
            orientationStatus.className = 'sensor-status status-waiting';
            
            // Veri toplama işlemini durdur
            stopDataCollection();
        }
        
        // İki nokta arasındaki mesafeyi hesaplama (Haversine formülü)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Dünya'nın yarıçapı (metre cinsinden)
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;
            
            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                     Math.cos(φ1) * Math.cos(φ2) *
                     Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            
            return R * c; // metre cinsinden mesafe
        }
        
        // İzinleri kontrol et ve iste
        async function requestPermissions() {
            // Sensör izinleri için
            if (navigator.permissions) {
                // Accelerometer izni
                try {
                    const accelerometerResult = await navigator.permissions.query({ name: 'accelerometer' });
                    console.log('Accelerometer izni:', accelerometerResult.state);
                } catch (error) {
                    console.error('Accelerometer izni sorgulanamadı:', error);
                }
                
                // Gyroscope izni
                try {
                    const gyroscopeResult = await navigator.permissions.query({ name: 'gyroscope' });
                    console.log('Gyroscope izni:', gyroscopeResult.state);
                } catch (error) {
                    console.error('Gyroscope izni sorgulanamadı:', error);
                }
                
                // Magnetometer izni
                try {
                    const magnetometerResult = await navigator.permissions.query({ name: 'magnetometer' });
                    console.log('Magnetometer izni:', magnetometerResult.state);
                } catch (error) {
                    console.error('Magnetometer izni sorgulanamadı:', error);
                }
            }
            
            // iOS için özel yönelim izni
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    console.log('iOS Yönelim izni:', permissionState);
                    if (permissionState === 'granted') {
                        // İzin verildi, sensörleri başlat
                        startSensors();
                    }
                } catch (error) {
                    console.error('iOS yönelim izni istenemedi:', error);
                    // İzin desteklenmiyor veya reddedildi, mevcut izinlerle devam et
                    startSensors();
                }
            } else {
                // iOS dışındaki cihazlar için doğrudan başlat
                startSensors();
            }
        }
        
        // Sayfa yüklendiğinde grafikleri başlat
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            
            // Başlat düğmesine tıklama
            startButton.addEventListener('click', () => {
                requestPermissions();
            });
            
            // Durdur düğmesine tıklama
            stopButton.addEventListener('click', () => {
                stopSensors();
            });
        });
    </script>
</body>
</html>